---
title: "02 data_analysis"
author: "Fabienne Kock"
date: "10 6 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
install
```{r}
install.packages("DescTools")
install.packages("Rmisc")
```

packages
```{r}
library(tidyverse)
library(effsize)
library(dplyr)
library(readr)
library(tidyr)
library(DescTools)
library(Rmisc)
```
## 1. read in the data
```{r}
exp_data <- read_csv("C:\\Users\\User\\Documents\\Semester4\\Psychology Lab\\XPLabFinal\\data\\03 paper\\clean\\S4b_exp_data.csv")
subj_data <- read_csv( "C:\\Users\\User\\Documents\\Semester4\\Psychology Lab\\XPLabFinal\\data\\03 paper\\clean\\S4b_subject_data.csv")
exp_data
```

## 2 Pearson correlation between each participants rating of the upright and the inverted faces
### 2.0 split data in inverted and transposed
```{r}
upright <- select(exp_data, ID, ends_with("upright"))
inverted <- select(exp_data, ID, ends_with("inverted"))
```
### 2.1 transpose data
```{r}
upright_t <- t(upright)
inverted_t <- t(inverted)
```

```{r}
colnames(upright_t) <- upright_t[1,]
upright_t<-upright_t[-1,]
colnames(inverted_t) <- inverted_t[1,]
inverted_t<-inverted_t[-1,]
```


### 2.2 calculate Pearson correlation
```{r}
pearson <- c()
col <- 1
while(col <= ncol(upright_t)){
  inv <- as.double(inverted_t[,col])
  up <- as.double(upright_t[,col])
  p_val <- cor.test(up,inv,method = "pearson")
  pearson <- c(pearson, toString(p_val)) 
  col <- col+ 1
}
exp_data$pearson <- pearson
```


how it should look like if one does not coerce it into a string
```{r} 
inv <- as.double(inverted_t[,7])
up <- as.double(upright_t[,7])
cor.test(up,inv,method = "pearson")

```

How it looks like in the dataframe
```{r}
exp_data
exp_data$pearson[7]

```
### 2.3 filter out correlation
Function to split the correlation from the information gained by applying Pearson
```{r}
getCorr <- function(row){
  corr <- strsplit(row, ",")
  corr <- corr[[1]]
  corr <- strsplit(corr[4],"=")
  corr <- corr[[1]]
  corr <- strsplit(corr[2],"\\)")
  corr <- corr[[1]]
return(corr)
}
```
Getting the Correlation for every row, adding it as row to the exp_data and converting it back to a numeric
```{r}
corr_list <- c()
row <- 1
while(row <= nrow(exp_data)){
  corr <- getCorr(exp_data$pearson[row])
  corr_list <- c(corr_list, corr)
  row <- row+1
}
```

```{r}
exp_data$Sesnsitivity_correlation <- corr_list
exp_data <- mutate(exp_data, Sesnsitivity_correlation = as.numeric(corr_list))
```


### 2.4 extract frame with ID pearson, and Sensitivity correlation
```{r}
analysed_data <- select(exp_data, ID, pearson, Sesnsitivity_correlation)
analysed_data
```
### 2.5 mean
```{r}
mean<-mean(analysed_data$Sesnsitivity_correlation, na.rm = TRUE)
mean
```
### 2.6 standardeviation
```{r}
sd <- sd(analysed_data$Sesnsitivity_correlation, na.rm = TRUE)
sd

```
### 2.7 VArianz
```{r}
var<-var(analysed_data$Sesnsitivity_correlation, na.rm = TRUE)
var
```
### 2.8 Confidenceintervall
```{r}
c(mean-1.96*sd, mean+1.96*sd)
```


## 3. one way ANova 
### 3.1 