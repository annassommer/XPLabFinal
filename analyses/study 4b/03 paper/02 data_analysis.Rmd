---
title: "02 data_analysis"
author: "Fabienne Kock"
date: "10 6 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
install
```{r}
install.packages("DescTools")
```

packages
```{r}
library(tidyverse)
library(effsize)
library(dplyr)
library(readr)
library(tidyr)
library(DescTools)
```
## 1. read in the data
```{r}
exp_data <- read_csv("C:\\Users\\User\\Documents\\Semester4\\Psychology Lab\\XPLabFinal\\data\\03 paper\\clean\\S4b_exp_data.csv")
subj_data <- read_csv( "C:\\Users\\User\\Documents\\Semester4\\Psychology Lab\\XPLabFinal\\data\\03 paper\\clean\\S4b_subject_data.csv")
exp_data
```

## 2 Pearson correlation between each participants rating of the upright and the inverted faces
### 2.0 split data in inverted and transposed
```{r}
upright <- select(exp_data, ID, ends_with("upright"))
inverted <- select(exp_data, ID, ends_with("inverted"))
```
### 2.1 transpose data
```{r}
upright_t <- t(upright)
inverted_t <- t(inverted)
```

```{r}
colnames(df.upright_t) <- df.upright_t[1,]
df.upright_t <- df.upright_t[-1,]
colnames(df.inverted_t) <- df.inverted_t[1,]
df.inverted_t <- df.inverted_t[-1,]

```


### 2.2 calculate Pearson correlation
```{r}
pearson <- c()
col <- 1
while(col <= ncol(upright_t)){
  name <- colnames(df.upright_t)[col]
  inv <- as.double(df.inverted_t[,name])
  up <- as.double(df.upright_t[,name])
  p_val <- cor.test(up,inv,method = "pearson")
  pearson <- c(pearson, toString(p_val)) 
  col <- col+ 1
}
exp_data$pearson <- pearson
```
how it should look like if one does not coerce it into a string
```{r} 
name <- colnames(df.upright_t)[1]
inv <- as.double(df.inverted_t[,name])
up <- as.double(df.upright_t[,name])
cor.test(up,inv,method = "pearson")

```

How it looks like in the dataframe
```{r}
exp_data
exp_data$pearson[1]

```
### 2.3 filter out pearsons rho
Function to split rho fromm the information gained by applying Pearson
```{r}
getRoh <- function(row){
  rho <- strsplit(row, ",")
  rho <- rho[[1]]
  rho <- strsplit(rho[4],"=")
  rho <- rho[[1]]
  rho <- strsplit(rho[2],"\\)")
  rho <- rho[[1]]
return(rho)
}

```
Getting rho for every row, adding it as row to the exp_data and converting it back to a numeric
```{r}
rho_list <- c()
row <- 1
while(row <= nrow(exp_data)){
  rho <- getRoh(exp_data$pearson[row])
  rho_list <- c(rho_list, rho)
  row <- row+1
}
exp_data$rho <- rho_list
exp_data <- mutate(exp_data, rho = as.numeric(rho))
```

Calculate Fisher z
```{r}
fz_list <- c()
row <- 1
while(row <= nrow(exp_data)){
  fz <- FisherZ(exp_data$rho[row])
  fz_list <- c(fz_list, fz)
  row <- row+1
}
exp_data$fisher_z <- fz_list

```

### 2.4 extract frame with ID pearson, rho and Fisher z
```{r}
analysed_data <- select(exp_data, ID, pearson, rho,fisher_z)
analysed_data
```


## 3. one way ANova 
### 3.1 